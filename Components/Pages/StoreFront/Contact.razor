@page "/contact"
@using System.ComponentModel.DataAnnotations
@using System.Web
@using MaillotStore.Data
@using Microsoft.EntityFrameworkCore
@inject NavigationManager NavigationManager
@inject ApplicationDbContext DbContext
@rendermode InteractiveServer

<style>
    /* Ensures links in the info list look like regular text but remain clickable */
    .info-list a {
        color: inherit;
        text-decoration: none;
    }
    .info-list a:hover {
        text-decoration: underline;
        color: #007bff; /* Adjust this color to match your theme */
    }
</style>

<div class="contact-us-container">
    <h1 class="contact-title">Contact Us</h1>
    <p class="contact-intro">
        Here at Maillot, we prioritize customer satisfaction which is why we have a support system that’s available 24/7 to tend to all of your needs.
    </p>

    <div class="contact-body">

        @* --- "GET IN TOUCH" SECTION --- *@
        <div class="contact-info-section">
            <h3 class="info-title">Get In Touch</h3>
            <ul class="info-list">
                <li>
                    <span class="icon"><i class="fa-solid fa-phone"></i></span>
                    <p><a href="tel:+237690059197">+237 690 05 91 97</a></p>
                </li>
                <li>
                    <span class="icon"><i class="fa-brands fa-whatsapp"></i></span>
                    <p>
                        <a href="https://wa.me/@(adminWhatsAppNumber.Replace("+", "").Replace(" ", ""))" target="_blank">
                            @(string.IsNullOrWhiteSpace(adminWhatsAppNumber) ? "+237 690 05 91 97" : adminWhatsAppNumber)
                        </a>
                    </p>
                </li>
                <li>
                    <span class="icon"><i class="fa-solid fa-envelope"></i></span>
                    <div>
                        <p><a href="mailto:support@maillotstore.store">support@maillotstore.store</a></p>
                        <p><a href="mailto:contact@maillotstore.store">contact@maillotstore.store</a></p>
                    </div>
                </li>
                <li>
                    <span class="icon"><i class="fa-solid fa-location-dot"></i></span>
                    <p>Douala, Cameroon</p>
                </li>
            </ul>

            <h3 class="info-title social-links-title">Social Links</h3>

            <div class="social-icons">
                <a href="https://wa.me/@(adminWhatsAppNumber.Replace("+", "").Replace(" ", ""))" target="_blank"><i class="fab fa-whatsapp"></i></a>

                <a href="https://www.instagram.com/maillotstorecm?igsh=MWRveGdudzZiMmN3dw%3D%3D&utm_source=qr" target="_blank"><i class="fab fa-instagram"></i></a>

                <a href="@tiktokUrl" target="_blank" class="social-icon">
                    <i class="fa-brands fa-tiktok"></i>
                </a>

                <a href="https://www.facebook.com/share/1CNhfJ9xaa/?mibextid=wwXIfr" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="https://snapchat.com/t/7TCZOspT" target="_blank"><i class="fab fa-snapchat-ghost"></i></a>
                <a href="https://x.com/maillotstorecm?s=21" target="_blank"><i class="fab fa-x-twitter"></i></a>
            </div>
        </div>

        @* --- "SEND US A MESSAGE" SECTION --- *@
        <div class="contact-form-section px-0 mx-0 px-md-3">
            <h3 class="form-title">Send Us A Message</h3>

            <EditForm Model="@contactForm" OnValidSubmit="HandleSubmit">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="form-group">
                    <InputText @bind-Value="contactForm.Name" class="form-control" placeholder="Name" />
                </div>
                <div class="form-group">
                    <InputText @bind-Value="contactForm.ContactInfo" class="form-control" placeholder="Email or Phone Number" />
                </div>
                <div class="form-group">
                    <InputTextArea @bind-Value="contactForm.Message" class="form-control" rows="8" placeholder="Message" />
                </div>
                <button type="submit" class="submit-message-btn">SUBMIT</button>
            </EditForm>
        </div>
    </div>
</div>

@code {
    private ContactForm contactForm = new();
    private string adminWhatsAppNumber = "237690059197"; // Default fallback

    private string tiktokUrl = "https://www.tiktok.com/@maillotstore.cm";

    protected override async Task OnInitializedAsync()
    {
        var setting = await DbContext.AdminSettings
            .AsNoTracking()
            .FirstOrDefaultAsync(s => s.Key == "AdminWhatsAppNumber");

        if (setting != null && !string.IsNullOrWhiteSpace(setting.Value))
        {
            adminWhatsAppNumber = setting.Value;
        }
    }

    private void HandleSubmit()
    {
        if (string.IsNullOrWhiteSpace(contactForm.ContactInfo)) return;

        if (contactForm.ContactInfo.Contains("@"))
        {
            var subject = HttpUtility.UrlEncode($"Message from {contactForm.Name}");
            var body = HttpUtility.UrlEncode(contactForm.Message);
            var mailtoUrl = $"mailto:support@maillotstore.store?subject={subject}&body={body}";
            NavigationManager.NavigateTo(mailtoUrl, forceLoad: true);
        }
        else
        {
            var text = HttpUtility.UrlEncode($"Name: {contactForm.Name}\nMessage: {contactForm.Message}");
            var whatsAppNumberForUrl = adminWhatsAppNumber.Replace("+", "").Replace(" ", "");
            var whatsappUrl = $"https://wa.me/{whatsAppNumberForUrl}?text={text}";

            NavigationManager.NavigateTo(whatsappUrl, forceLoad: true);
        }

        contactForm = new();
    }

    public class ContactForm
    {
        [Required]
        public string Name { get; set; }

        [Required(ErrorMessage = "Please enter your email or phone number.")]
        public string ContactInfo { get; set; }

        [Required]
        public string Message { get; set; }
    }
}