@inject NavigationManager NavigationManager
@implements IDisposable

<div class="admin-sidebar">
    <nav class="admin-nav">
        <a href="/admin/dashboard" class="@GetNavLinkClass("/admin/dashboard")">
            Dashboard
        </a>
        <a href="/admin/products" class="@GetNavLinkClass("/admin/products")">
            Products
        </a>
        <a href="/admin/leagues" class="@GetNavLinkClass("/admin/leagues")">
            Manage Leagues
        </a>
        <a href="/admin/teams" class="@GetNavLinkClass("/admin/teams")">
            Manage Teams
        </a>
        <a href="/admin/orders" class="@GetNavLinkClass("/admin/orders")">
            Orders
        </a>
        <a href="/admin/influencers" class="@GetNavLinkClass("/admin/influencers")">
            Influencers
        </a>
        <a href="/admin/commissions" class="@GetNavLinkClass("/admin/commissions")">
            Commission
        </a>
        <a href="/admin/settings" class="@GetNavLinkClass("/admin/settings")">
            Settings
        </a>

        <form action="/Account/Logout" method="post">
            <AntiforgeryToken />
            <input type="hidden" name="returnUrl" value="/" />
            <button type="submit" class="nav-link btn btn-link">Logout</button>
        </form>
    </nav>
</div>

@code {
    protected override void OnInitialized()
    {
        NavigationManager.LocationChanged += HandleLocationChanged;
    }

    private string GetNavLinkClass(string navLink)
    {
        if (NavigationManager.Uri.Contains(navLink, StringComparison.OrdinalIgnoreCase))
        {
            return "nav-link active";
        }

        if (navLink == "/admin/dashboard" && NavigationManager.Uri.EndsWith("/admin"))
        {
            return "nav-link active";
        }

        return "nav-link";
    }

    // UPDATED SIGNATURE: object? sender
    private void HandleLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= HandleLocationChanged;
    }
}